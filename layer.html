<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Layer</title>
  <meta name="description"
    content="Modern project management with Linear-inspired design. Track issues, manage projects, and stay organized." />
  <!-- Favicon (PNG) -->
  <link rel="icon" href="/logo.png?v=2" type="image/png" sizes="32x32">
  <link rel="shortcut icon" href="/logo.png?v=2" type="image/png">
  <link rel="apple-touch-icon" href="/logo.png?v=2">
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="components.css" />
  <link rel="stylesheet" href="themes.css" />
  <link rel="stylesheet" href="drafts.css" />
  <link rel="stylesheet" href="grid-diagram.css" />
  <link rel="stylesheet" href="calculator.css" />
  <link rel="stylesheet" href="circuit.css" />
  <!-- KaTeX for Mathematical Rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOvwMRrDsoLfqdCoicWJ389b+cvhk3wif7hYHJUliP/O8kNpLlI6glMttYI1h9zpq" crossorigin="anonymous">
  <!-- Inter font for UI -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Code+Pro:wght@400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
    integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xyflow/react@1/dist/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xyflow/react@1/dist/umd/index.js"></script>
  <!-- KaTeX for Mathematical Rendering -->
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTxOo" crossorigin="anonymous"></script>
</head>

<body>
  <!-- Refined Minimalistic Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-animation-wrapper">
      <div class="logo-animation">
        <svg class="logo-icon-animated" width="80" height="80" viewBox="0 0 128 128" fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="loaderGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#7c3aed" />
              <stop offset="100%" stop-color="#5b21b6" />
            </linearGradient>
          </defs>
          <rect class="logo-rect logo-rect-1" x="38" y="38" width="52" height="52" rx="16"
            fill="url(#loaderGradient)" />
          <rect class="logo-rect logo-rect-2" x="38" y="54" width="52" height="36" rx="14"
            fill="url(#loaderGradient)" />
          <rect class="logo-rect logo-rect-3" x="38" y="70" width="52" height="20" rx="10"
            fill="url(#loaderGradient)" />
          <rect class="logo-rect logo-rect-4" x="38" y="38" width="20" height="52" rx="10"
            fill="url(#loaderGradient)" />
        </svg>
      </div>
      <div class="loading-text-minimal">
        <span class="letter">L</span>
        <span class="letter">A</span>
        <span class="letter">Y</span>
        <span class="letter">E</span>
        <span class="letter">R</span>
      </div>
      <div class="loading-progress-container">
        <div class="loading-progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Login/Signup Page Overlay -->
  <div class="login-page-overlay" id="loginPageOverlay" style="display: none;">
    <div class="login-page-bg" id="loginPageBg"></div>
    <div class="login-page-container">
      <div class="login-page-left">
        <div class="login-branding">
          <div class="login-logo">
            <svg width="60" height="60" viewBox="0 0 128 128" fill="none" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="loginLogoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#7c3aed" />
                  <stop offset="100%" stop-color="#5b21b6" />
                </linearGradient>
              </defs>
              <rect x="38" y="38" width="52" height="52" rx="16" fill="url(#loginLogoGradient)" opacity="0.28" />
              <rect x="38" y="54" width="52" height="36" rx="14" fill="url(#loginLogoGradient)" opacity="0.55" />
              <rect x="38" y="70" width="52" height="20" rx="10" fill="url(#loginLogoGradient)" />
              <rect x="38" y="38" width="20" height="52" rx="10" fill="url(#loginLogoGradient)" />
            </svg>
          </div>
          <h1 class="login-title">Layer</h1>
          <p class="login-subtitle">Welcome back</p>
        </div>
      </div>
      
      <div class="login-page-right">
        <div class="login-form-container">
          <div class="login-form-header">
            <h2 id="loginFormTitle">Welcome Back</h2>
            <p id="loginFormSubtitle">Sign in to your workspace to continue</p>
          </div>

          <div class="login-tabs">
            <button class="login-tab active" id="loginTabBtn" onclick="switchLoginMode('signin')">Sign In</button>
            <button class="login-tab" id="signupTabBtn" onclick="switchLoginMode('signup')">Sign Up</button>
          </div>
          
          <form id="loginForm" class="login-form" onsubmit="handleLoginSubmit(event)">
            <div class="login-form-group">
              <label class="login-form-label">Email Address</label>
              <div class="login-input-wrapper">
                <svg class="login-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/>
                </svg>
                <input type="email" class="login-form-input" id="loginEmail" placeholder="name@company.com" required />
              </div>
            </div>
            
            <div class="login-form-group" id="usernameGroup" style="display: none;">
              <label class="login-form-label">Username</label>
              <div class="login-input-wrapper">
                <svg class="login-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                </svg>
                <input type="text" class="login-form-input" id="loginUsername" placeholder="Your name" />
              </div>
            </div>
            
            <div class="login-form-group">
              <label class="login-form-label">Password</label>
              <div class="login-input-wrapper">
                <svg class="login-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <input type="password" class="login-form-input" id="loginPassword" placeholder="••••••••" required minlength="6" />
              </div>
            </div>
            
            <div class="login-form-group" id="confirmPasswordGroup" style="display: none;">
              <label class="login-form-label">Confirm Password</label>
              <div class="login-input-wrapper">
                <svg class="login-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
                <input type="password" class="login-form-input" id="loginConfirmPassword" placeholder="••••••••" minlength="6" />
              </div>
            </div>
            
            <div id="loginError" class="login-error" style="display: none;"></div>
            
            <button type="submit" class="login-submit-btn">
              <span id="loginSubmitText">Sign In</span>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
            </button>
          </form>

          <div class="login-divider">
            <span>or continue with</span>
          </div>

          <button type="button" class="google-login-btn" onclick="handleGoogleSignIn()">
            <svg viewBox="0 0 48 48">
              <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
              <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
              <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24s.92 7.54 2.56 10.78l7.97-6.19z"></path>
              <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
            </svg>
            <span>Google</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="app" style="opacity: 0;">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <svg class="logo-icon" width="40" height="40" viewBox="0 0 128 128" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="logoGradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#7c3aed" />
                <stop offset="100%" stop-color="#5b21b6" />
              </linearGradient>
            </defs>
            <rect x="38" y="38" width="52" height="52" rx="16" fill="url(#logoGradient1)" opacity="0.28" />
            <rect x="38" y="54" width="52" height="36" rx="14" fill="url(#logoGradient1)" opacity="0.55" />
            <rect x="38" y="70" width="52" height="20" rx="10" fill="url(#logoGradient1)" />
            <rect x="38" y="38" width="20" height="52" rx="10" fill="url(#logoGradient1)" />
          </svg>
          <div class="logo-text-container">
            <span class="logo-text">Layer</span>
            <span class="logo-subtitle">workspace</span>
          </div>
        </div>
        <button class="sidebar-collapse-btn" id="sidebarCollapseBtn" title="Collapse sidebar">
          <svg class="icon collapse-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M15 18l-6-6 6-6" />
          </svg>
          <svg class="icon expand-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <path d="M9 18l6-6-6-6" />
          </svg>
        </button>
      </div>

      <!-- Create Button in Sidebar -->
      <div class="sidebar-create-section">
        <button class="sidebar-create-btn" id="sidebarCreateBtn" onclick="toggleSidebarCreateDropdown()">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14" />
          </svg>
          <span>Create</span>
          <svg class="icon dropdown-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 9l6 6 6-6" />
          </svg>
        </button>
        <div class="sidebar-create-dropdown" id="sidebarCreateDropdown">
          <button class="sidebar-create-item" onclick="openDocEditor(); closeSidebarCreateDropdown();">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <style>
                @keyframes lineExpand {
                  0% {
                    stroke-dashoffset: 8;
                    transform: scaleX(0);
                    transform-origin: left;
                  }

                  100% {
                    stroke-dashoffset: 0;
                    transform: scaleX(1);
                  }
                }

                @keyframes linePulse {

                  0%,
                  100% {
                    opacity: 1;
                    stroke-width: 2;
                  }

                  50% {
                    opacity: 0.6;
                    stroke-width: 2.5;
                  }
                }

                .sidebar-create-item:hover .doc-line {
                  animation: lineExpand 0.4s ease-out, linePulse 0.5s ease-in-out;
                  stroke-dasharray: 8;
                }

                .sidebar-create-item:hover .doc-line:nth-child(4) {
                  animation-delay: 0.15s;
                }
              </style>

              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line class="doc-line" x1="16" y1="13" x2="8" y2="13"></line>
              <line class="doc-line" x1="16" y1="17" x2="8" y2="17"></line>
            </svg>
            <span>Doc</span>
          </button>
          <button class="sidebar-create-item" onclick="openExcelEditor(); closeSidebarCreateDropdown();">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <style>
                @keyframes tablePop {

                  0%,
                  100% {
                    transform: scale(1);
                  }

                  50% {
                    transform: scale(1.08);
                  }
                }

                @keyframes gridDraw {
                  0% {
                    stroke-dashoffset: 18;
                    opacity: 0;
                  }

                  100% {
                    stroke-dashoffset: 0;
                    opacity: 1;
                  }
                }

                @keyframes gridPulse {

                  0%,
                  100% {
                    stroke-width: 2;
                  }

                  50% {
                    stroke-width: 2.5;
                  }
                }

                .sidebar-create-item:hover .table-frame {
                  animation: tablePop 0.4s ease-in-out;
                }

                .sidebar-create-item:hover .grid-line {
                  animation: gridDraw 0.4s ease-out, gridPulse 0.5s ease-in-out;
                  stroke-dasharray: 18;
                }

                .sidebar-create-item:hover .grid-line:nth-child(2) {
                  animation-delay: 0.1s;
                }

                .sidebar-create-item:hover .grid-line:nth-child(3) {
                  animation-delay: 0.2s;
                }
              </style>

              <rect class="table-frame" x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
              <line class="grid-line" x1="3" y1="9" x2="21" y2="9"></line>
              <line class="grid-line" x1="9" y1="3" x2="9" y2="21"></line>
              <line class="grid-line" x1="9" y1="3" x2="9" y2="21"></line>
            </svg>
            <span>Sheet</span>
          </button>
          <button class="sidebar-create-item" onclick="openNewSpaceModal(); closeSidebarCreateDropdown();">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <style>
                @keyframes folderLift {

                  0%,
                  100% {
                    transform: translateY(0) scale(1);
                  }

                  50% {
                    transform: translateY(-3px) scale(1.05);
                  }
                }

                @keyframes plusExpand {
                  0% {
                    stroke-dashoffset: 6;
                    transform: scale(0);
                    opacity: 0;
                  }

                  100% {
                    stroke-dashoffset: 0;
                    transform: scale(1);
                    opacity: 1;
                  }
                }

                @keyframes plusPulse {

                  0%,
                  100% {
                    stroke-width: 2;
                  }

                  50% {
                    stroke-width: 2.5;
                  }
                }

                .sidebar-create-item:hover .folder-path {
                  animation: folderLift 0.4s ease-in-out;
                  transform-origin: bottom center;
                }

                .sidebar-create-item:hover .plus-line {
                  animation: plusExpand 0.4s ease-out, plusPulse 0.5s ease-in-out;
                  stroke-dasharray: 6;
                  transform-origin: center;
                }

                .sidebar-create-item:hover .plus-line:nth-child(3) {
                  animation-delay: 0.1s;
                }
              </style>

              <path class="folder-path" d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z">
              </path>
              <line class="plus-line" x1="12" y1="11" x2="12" y2="17"></line>
              <line class="plus-line" x1="9" y1="14" x2="15" y2="14"></line>
            </svg>
            <span>Space</span>
          </button>
          <button class="sidebar-create-item" onclick="createWhiteboardDraft().then(index => { if(index !== null) openGripDiagram(index); }); closeSidebarCreateDropdown();">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <style>
                @keyframes boardPop {

                  0%,
                  100% {
                    transform: scale(1);
                  }

                  50% {
                    transform: scale(1.08);
                  }
                }

                @keyframes drawLine {
                  0% {
                    stroke-dashoffset: 20;
                    opacity: 0;
                  }

                  100% {
                    stroke-dashoffset: 0;
                    opacity: 1;
                  }
                }

                @keyframes penWrite {

                  0%,
                  100% {
                    transform: translate(0, 0) rotate(0deg);
                  }

                  25% {
                    transform: translate(-2px, -2px) rotate(-10deg);
                  }

                  50% {
                    transform: translate(2px, -1px) rotate(5deg);
                  }

                  75% {
                    transform: translate(-1px, -2px) rotate(-5deg);
                  }
                }

                .sidebar-create-item:hover .board-content {
                  animation: boardPop 0.4s ease-in-out;
                }

                .sidebar-create-item:hover .board-line {
                  animation: drawLine 0.4s ease-out;
                  stroke-dasharray: 20;
                }

                .sidebar-create-item:hover .board-line:nth-child(2) {
                  animation-delay: 0.1s;
                }

                .sidebar-create-item:hover .board-line:nth-child(3) {
                  animation-delay: 0.2s;
                }

                .sidebar-create-item:hover .pen {
                  animation: penWrite 0.6s ease-in-out;
                  transform-origin: bottom right;
                }
              </style>

              <!-- Whiteboard frame -->
              <g class="board-content">
                <rect x="2" y="3" width="18" height="14" rx="1"></rect>

                <!-- Content lines on board -->
                <line class="board-line" x1="5" y1="7" x2="11" y2="7"></line>
                <line class="board-line" x1="5" y1="10" x2="14" y2="10"></line>
                <line class="board-line" x1="5" y1="13" x2="9" y2="13"></line>
              </g>

              <!-- Stand legs -->
              <line x1="6" y1="17" x2="5" y2="22"></line>
              <line x1="16" y1="17" x2="17" y2="22"></line>

              <!-- Pen/marker (more prominent) -->
              <g class="pen">
                <path d="M18 14l3 3"></path>
                <path d="M17 13l1-1 3 3-1 1z"></path>
                <line x1="21" y1="16" x2="22" y2="17"></line>
              </g>
            </svg>
            <span>Whiteboard</span>
          </button>
        </div>
      </div>

      <nav class="sidebar-nav">
        <!-- MODIFIED: Added active class here instead of My Issues -->
        <button class="nav-item active" data-view="inbox">
          <svg class="icon dashboard-icon" width="24" height="24" viewBox="0 0 100 100" fill="none"
            xmlns="http://www.w3.org/2000/svg" aria-label="Dashboard icon – minimal">
            <style>
              @keyframes cleanSlideFade {
                0% {
                  opacity: 0;
                  transform: translateY(12px);
                }

                100% {
                  opacity: 1;
                  transform: translateY(0);
                }
              }

              .nav-item.active .dashboard-icon .tile {
                animation: cleanSlideFade 0.7s cubic-bezier(0.4, 0.0, 0.2, 1) forwards;
                animation-delay: calc(var(--i) * 0.1s);
              }
            </style>
            <rect class="tile" x="16" y="16" width="32" height="32" rx="10" fill="currentColor" fill-opacity="0.92"
              style="--i:0" />
            <rect class="tile" x="52" y="16" width="32" height="32" rx="10" fill="currentColor" fill-opacity="0.92"
              style="--i:1" />
            <rect class="tile" x="16" y="52" width="32" height="32" rx="10" fill="currentColor" fill-opacity="0.92"
              style="--i:2" />
            <rect class="tile" x="52" y="52" width="32" height="32" rx="10" fill="currentColor" fill-opacity="0.92"
              style="--i:3" />
          </svg>
          <span>Dashboard</span>
        </button>
        <!-- MODIFIED: Removed active class from here -->
        <button class="nav-item" data-view="my-issues">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <style>
              @keyframes clipboardPop {

                0%,
                100% {
                  transform: scale(1) translateY(0);
                }

                50% {
                  transform: scale(1.1) translateY(-2px);
                }
              }

              @keyframes checkmark {
                0% {
                  stroke-dashoffset: 20;
                  opacity: 0;
                }

                50% {
                  opacity: 1;
                }

                100% {
                  stroke-dashoffset: 0;
                  opacity: 0;
                }
              }

              .nav-item.active .icon .clipboard-body {
                animation: clipboardPop 0.5s ease-in-out;
              }

              .nav-item.active .icon .checkmark {
                animation: checkmark 0.6s ease-in-out;
              }

              .checkmark {
                opacity: 0;
                stroke-dasharray: 20;
                stroke-dashoffset: 20;
              }
            </style>

            <g class="clipboard-body">
              <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"></path>
              <rect x="9" y="3" width="6" height="4" rx="1"></rect>
            </g>

            <polyline class="checkmark" points="9 12 11 14 15 10" stroke-width="2"></polyline>
          </svg>
          <span>My issues</span>
        </button>

        <button class="nav-item" data-view="schedule">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <style>
              @keyframes calendarPop {

                0%,
                100% {
                  transform: scale(1);
                }

                50% {
                  transform: scale(1.08);
                }
              }

              @keyframes slideDown {
                0% {
                  transform: translateY(-2px);
                  opacity: 0.5;
                }

                100% {
                  transform: translateY(0);
                  opacity: 1;
                }
              }

              .nav-item.active .icon {
                animation: calendarPop 0.3s ease-in-out;
              }

              .nav-item.active .icon .divider {
                animation: slideDown 0.3s ease-out;
              }
            </style>

            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line class="divider" x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span>Schedule</span>
        </button>

        <div class="workspace-section">
          <div class="workspace-title">WORKSPACE</div>
          <button class="nav-item nav-item-nested" data-view="activity">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <style>
                @keyframes hexToSquare {
                  0% {
                    d: path("M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z");
                  }

                  50% {
                    d: path("M19 5 L19 5 L19 19 L19 19 L5 19 L5 19 L5 5 L5 5 Z");
                  }

                  100% {
                    d: path("M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z");
                  }
                }

                @keyframes rotate {
                  0% {
                    transform: rotate(0deg);
                  }

                  50% {
                    transform: rotate(180deg);
                  }

                  100% {
                    transform: rotate(360deg);
                  }
                }

                .nav-item.active .icon .hex-path {
                  animation: hexToSquare 0.6s ease-in-out, rotate 0.6s ease-in-out;
                  transform-origin: center;
                }
              </style>

              <path class="hex-path"
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
              </path>
            </svg>
            <span>Projects</span>
          </button>
          <button class="nav-item" data-view="drafts">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
              <polyline points="14 2 14 8 20 8" />
              <line x1="16" y1="13" x2="8" y2="13" />
              <line x1="16" y1="17" x2="8" y2="17" />
              <polyline points="10 9 9 9 8 9" />
            </svg>
            <span>Drafts</span>
          </button>
        </div>

        <button class="nav-item" data-view="team">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <style>
              @keyframes userPop {

                0%,
                100% {
                  transform: scale(1) translateY(0);
                }

                50% {
                  transform: scale(1.1) translateY(-2px);
                }
              }

              @keyframes slideIn {
                0% {
                  transform: translateX(-5px);
                  opacity: 0;
                }

                100% {
                  transform: translateX(0);
                  opacity: 1;
                }
              }

              @keyframes fadeIn {
                0% {
                  opacity: 0;
                  transform: scale(0.8);
                }

                100% {
                  opacity: 1;
                  transform: scale(1);
                }
              }

              .nav-item.active .icon .main-user {
                animation: userPop 0.4s ease-in-out;
              }

              .nav-item.active .icon .second-user {
                animation: slideIn 0.4s ease-out;
              }

              .nav-item.active .icon .user-circle {
                animation: fadeIn 0.3s ease-out;
              }

              .main-user,
              .second-user,
              .user-circle {
                transform-origin: center;
              }
            </style>

            <g class="main-user">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle class="user-circle" cx="9" cy="7" r="4"></circle>
            </g>

            <g class="second-user">
              <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
              <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </g>
          </svg>
          <span>Team</span>
        </button>
        <button class="nav-item" data-view="ai">
          <div class="ai-nav-icon-animated">
            <svg class="icon ai-icon-glasses" viewBox="0 0 24 24" fill="none" stroke="url(#aiNavGradient)"
              stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <style>
                @keyframes glassesAdjust {

                  0%,
                  100% {
                    transform: translateY(0) rotate(0deg);
                  }

                  30% {
                    transform: translateY(-3px) rotate(-2deg);
                  }

                  70% {
                    transform: translateY(-3px) rotate(2deg);
                  }
                }

                @keyframes lensPulse {

                  0%,
                  100% {
                    transform: scale(1);
                    opacity: 1;
                  }

                  50% {
                    transform: scale(1.15);
                    opacity: 0.8;
                  }
                }

                @keyframes templeSlide {
                  0% {
                    stroke-dashoffset: 10;
                  }

                  100% {
                    stroke-dashoffset: 0;
                  }
                }

                .nav-item.active .ai-nav-icon-animated .ai-icon-glasses {
                  animation: glassesAdjust 0.5s ease-in-out;
                }

                .nav-item.active .ai-nav-icon-animated .ai-icon-glasses .lens {
                  animation: lensPulse 0.4s ease-in-out;
                }

                .nav-item.active .ai-nav-icon-animated .ai-icon-glasses .lens:nth-child(2) {
                  animation-delay: 0.1s;
                }

                .nav-item.active .ai-nav-icon-animated .ai-icon-glasses .temple {
                  animation: templeSlide 0.3s ease-out;
                  stroke-dasharray: 10;
                }

                .lens,
                .temple {
                  transform-origin: center;
                }
              </style>

              <defs>
                <linearGradient id="aiNavGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stop-color="#6366f1">
                    <animate attributeName="stop-color" values="#6366f1;#8b5cf6;#3b82f6;#06b6d4;#6366f1" dur="6s"
                      repeatCount="indefinite"></animate>
                  </stop>
                  <stop offset="50%" stop-color="#a855f7">
                    <animate attributeName="stop-color" values="#a855f7;#ec4899;#8b5cf6;#3b82f6;#a855f7" dur="6s"
                      repeatCount="indefinite"></animate>
                  </stop>
                  <stop offset="100%" stop-color="#3b82f6">
                    <animate attributeName="stop-color" values="#3b82f6;#06b6d4;#6366f1;#8b5cf6;#3b82f6" dur="6s"
                      repeatCount="indefinite"></animate>
                  </stop>
                </linearGradient>
              </defs>

              <!-- Left lens -->
              <circle class="lens" cx="8" cy="12" r="4"></circle>

              <!-- Right lens -->
              <circle class="lens" cx="16" cy="12" r="4"></circle>

              <!-- Bridge connection -->
              <path d="M12 10L12 14"></path>

              <!-- Left temple -->
              <path class="temple" d="M4 12L6 10"></path>

              <!-- Right temple -->
              <path class="temple" d="M18 10L20 12"></path>
            </svg>
          </div>
          <span>AI</span>
        </button>
        <button class="nav-item" data-view="settings">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <style>
              @keyframes gearRotate {
                0% {
                  transform: rotate(0deg);
                }

                100% {
                  transform: rotate(90deg);
                }
              }

              @keyframes centerPulse {

                0%,
                100% {
                  transform: scale(1);
                }

                50% {
                  transform: scale(1.2);
                }
              }

              @keyframes gearDraw {
                0% {
                  stroke-dashoffset: 200;
                }

                100% {
                  stroke-dashoffset: 0;
                }
              }

              .nav-item.active .icon .gear-outer {
                animation: gearRotate 0.5s ease-in-out, gearDraw 0.5s ease-out;
                stroke-dasharray: 200;
                transform-origin: center;
              }

              .nav-item.active .icon .gear-center {
                animation: centerPulse 0.4s ease-in-out;
                transform-origin: center;
              }
            </style>

            <circle class="gear-center" cx="12" cy="12" r="3"></circle>
            <path class="gear-outer"
              d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z">
            </path>
          </svg>
          <span>Settings</span>
        </button>
      </nav>

      <!-- Focus Mode Toggle -->
      <div class="focus-mode-trigger" id="focusModeToggle">
        <button class="focus-toggle-btn" onclick="toggleFocusModeExpand()">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <path d="M12 6v6l4 2" />
          </svg>
          <span>Focus Mode</span>
        </button>
        
        <!-- Expandable Focus Mode Content -->
        <div class="focus-mode-expandable" id="focusModeExpandable">
          <div class="focus-mode-content">
            <div class="focus-form-group">
              <select id="focusProjectSelect" class="focus-form-select">
                <!-- Projects will be populated by JavaScript -->
              </select>
            </div>
            
            <div class="focus-form-group">
              <select id="focusDurationSelect" class="focus-form-select">
                <option value="25">25 minutes</option>
                <option value="45">45 minutes</option>
                <option value="60">1 hour</option>
                <option value="0" selected>No limit</option>
              </select>
            </div>
            
            <div class="focus-actions">
              <button class="focus-btn focus-btn-secondary" onclick="toggleFocusModeExpand()">Cancel</button>
              <button class="focus-btn focus-btn-primary" onclick="startFocusMode()">
                Start Focus
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="sidebar-footer">
        <button class="sign-in-btn" id="signInBtn" onclick="openAuthModal()">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
            <polyline points="10 17 15 12 10 7" />
            <line x1="15" y1="12" x2="3" y2="12" />
          </svg>
          <span>Sign In</span>
        </button>
      </div>
    </aside>

    <!-- Mobile Header -->
    <header class="mobile-header" id="mobileHeader">
      <div class="mobile-header-left">
        <svg class="mobile-logo-icon" width="26" height="26" viewBox="0 0 128 128" fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="logoGradient2" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#7c3aed" />
              <stop offset="100%" stop-color="#5b21b6" />
            </linearGradient>
          </defs>
          <rect x="38" y="38" width="52" height="52" rx="16" fill="url(#logoGradient2)" opacity="0.28" />
          <rect x="38" y="54" width="52" height="36" rx="14" fill="url(#logoGradient2)" opacity="0.55" />
          <rect x="38" y="70" width="52" height="20" rx="10" fill="url(#logoGradient2)" />
          <rect x="38" y="38" width="20" height="52" rx="10" fill="url(#logoGradient2)" />
        </svg>
        <span class="mobile-header-logo">Layer</span>
      </div>
      <div class="mobile-header-right">
        <button class="mobile-header-btn" id="mobileSearchBtn" title="Search">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="M21 21l-4.35-4.35" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Mobile Search Overlay -->
    <div class="mobile-search-overlay" id="mobileSearchOverlay">
      <div class="mobile-search-container">
        <svg class="mobile-search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8" />
          <path d="M21 21l-4.35-4.35" />
        </svg>
        <input type="text" id="mobileSearchInput" class="mobile-search-input" placeholder="Search..." />
        <button class="mobile-search-close-btn" id="mobileSearchCloseBtn" title="Close search">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Hidden search input for JS compatibility -->
      <input type="hidden" id="searchInput" />
      <input type="hidden" id="breadcrumbText" />

      <!-- Views Container -->
      <div class="views-container" id="viewsContainer">
        <!-- Views will be rendered here -->
      </div>
    </main>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-bottom-nav" id="mobileBottomNav">
    <button class="mobile-nav-item" data-view="inbox">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="7" height="7" />
        <rect x="14" y="3" width="7" height="7" />
        <rect x="14" y="14" width="7" height="7" />
        <rect x="3" y="14" width="7" height="7" />
      </svg>
      <span>Dashboard</span>
    </button>
    <button class="mobile-nav-item" data-view="my-issues">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10" />
        <path d="M8 12l2 2 4-4" />
      </svg>
      <span>Issues</span>
    </button>

    <button class="mobile-nav-item" data-view="activity">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
      </svg>
      <span>Projects</span>
    </button>
    <button class="mobile-nav-item" data-view="schedule">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
        <line x1="16" y1="2" x2="16" y2="6" />
        <line x1="8" y1="2" x2="8" y2="6" />
        <line x1="3" y1="10" x2="21" y2="10" />
      </svg>
      <span>Schedule</span>
    </button>
    <button class="mobile-nav-item" data-view="team">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
      </svg>
      <span>Team</span>
    </button>
    <button class="mobile-nav-item" data-view="ai">
      <svg class="icon ai-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 3L14.5 9L21 11.5L14.5 14L12 20L9.5 14L3 11.5L9.5 9L12 3Z" />
        <circle cx="12" cy="11.5" r="2" />
      </svg>
      <span>AI</span>
    </button>
    <button class="mobile-nav-item" data-view="settings">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="3" />
        <path
          d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
      </svg>
      <span>Settings</span>
    </button>
  </nav>

  <!-- Modals -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Modal</h2>
        <button class="modal-close" id="modalClose">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="modal-content" id="modalContent">
        <!-- Dynamic content -->
      </div>
    </div>
  </div>

  <!-- PDF Viewer Modal -->
  <div class="pdf-viewer-overlay" id="pdfViewerOverlay" style="display: none;">
    <div class="pdf-viewer-container">
      <div class="pdf-viewer-header">
        <h3 id="pdfViewerTitle">PDF Viewer</h3>
        <div class="pdf-viewer-actions">
          <button class="btn btn-primary" id="pdfDownloadBtn" onclick="downloadCurrentPdf()">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
            Download
          </button>
          <button class="btn btn-secondary" onclick="closePdfViewer()">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
            Close
          </button>
        </div>
      </div>
      <iframe id="pdfViewerFrame" style="width:100%; height: calc(100vh - 120px); border:none;"></iframe>
    </div>
  </div>

  <!-- Focus Timer Float Widget - Draggable with Snap to Corner -->
  <div class="focus-timer-float" id="focusTimerFloat" style="display: none;">
    <div class="focus-timer-widget" id="focusTimerWidget">
      <div class="timer-drag-handle"></div>
      <div class="timer-main" onclick="toggleTimerExpand()">
        <div>
          <div class="timer-display" id="timerDisplay">00:00</div>
          <div class="timer-project" id="timerProjectName">Project Name</div>
        </div>
      </div>
      <div class="timer-controls">
        <button class="timer-btn pause" id="timerPauseBtn" onclick="event.stopPropagation(); toggleTimerPause()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            style="width: 16px; height: 16px;">
            <rect x="6" y="4" width="4" height="16" id="pauseIcon1" />
            <rect x="14" y="4" width="4" height="16" id="pauseIcon2" />
          </svg>
          <span id="pauseBtnText">Pause</span>
        </button>
        <button class="timer-btn stop" onclick="event.stopPropagation(); stopFocusMode()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            style="width: 16px; height: 16px;">
            <rect x="4" y="4" width="16" height="16" rx="2" />
          </svg>
          Stop
        </button>
      </div>
      <div class="timer-tasks" id="timerTasks">
        <div class="timer-tasks-header">
          <span>Tasks</span>
          <span id="tasksProgress">0/0</span>
        </div>
        <div class="timer-tasks-list" id="timerTasksList">
          <!-- Tasks populated dynamically -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Immediate theme application - runs before anything else
    (function () {
      const savedTheme = localStorage.getItem('layerTheme') || 'dark';
      const savedMode = localStorage.getItem('layerThemeMode') || 'dark';

      if (savedTheme === 'light') {
        document.body.classList.add('light');
      } else if (savedTheme === 'dark') {
        // Default dark theme, no data-theme attribute needed
      } else {
        // Custom theme
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.documentElement.setAttribute('data-mode', savedMode);
      }
    })();
  </script>
  <!-- Supabase Client Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-client.js?v=6"></script>
  <script src="realtime.js?v=4"></script>
  <script src="data-store.js?v=5"></script>
  <script src="app.js?v=5"></script>
  <script src="functionality.js?v=5"></script>
  <script src="animated-background.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="color-bends.js"></script>
  <script src="grid-diagram.js"></script>
  <script src="calculator.js"></script>
  <script src="circuit.js"></script>
  <script src="test-leave-project.js"></script>
  <script type="module" src="gemini-api.js"></script>
</body>

</html>